---
title: "mp4"
author: "Emily Morris"
date: "April 16, 2018"
output: html_document
---

```{r}

#install.packages("mdsr")
#install.packages("RMySQL")

library(mdsr)
library(RMySQL)
library(tidyverse)
library(dplyr)
whole_db <- dbConnect_scidb(dbname= "imdb")
```

```{r}
getmovie <- "SELECT movie_id
FROM movie_info
WHERE info_type_id = 92;"

getgross <- "SELECT substr(info, 1, locate('(', info) - 1) AS gross, movie_id
FROM movie_info
WHERE info_type_id= 107 AND info LIKE '%(USA)%' AND info LIKE '$%'"

gettitles <- "SELECT id AS movie_id, title, production_year AS year
FROM title
WHERE kind_id =1;"
```

```{r}
movie_ids <- whole_db %>%
dbGetQuery(getmovie)

movie_titles <- whole_db %>%
  dbGetQuery(gettitles)

movie_gross <- whole_db %>%
  dbGetQuery(getgross)
```

```{r}
movies <- movie_ids %>%
  left_join(movie_gross, by = "movie_id")%>%
  na.omit()%>%
  group_by(movie_id)%>%
  summarise(max_made = max(gross))%>%
  select(movie_id, max_made)%>%
  inner_join(movie_titles, by = "movie_id")%>%
  arrange(year)
```



```