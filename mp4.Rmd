---
title: "mp4"
author: "Emily Morris"
date: "April 16, 2018"
output: html_document
---

```{r}

#install.packages("mdsr")
#install.packages("RMySQL")

library(mdsr)
library(RMySQL)
library(tidyverse)
library(dplyr)
whole_db <- dbConnect_scidb(dbname= "imdb")
```

```{r}
#sql queries for all imdb things based on books, the gross of everything made in America in dollars, and all movies and their titles/movie_ids

getmovie <- "SELECT movie_id
FROM movie_info
WHERE info_type_id = 92;"

getgross <- "SELECT substr(info, 1, locate('(', info) - 1) AS gross, movie_id
FROM movie_info
WHERE info_type_id= 107 AND info LIKE '%(USA)%' AND info LIKE '$%'"

gettitles <- "SELECT id AS movie_id, title, production_year AS year
FROM title
WHERE kind_id =1;"
```

```{r}
#running all those queries as objects

movie_ids <- whole_db %>%
dbGetQuery(getmovie)

movie_titles <- whole_db %>%
  dbGetQuery(gettitles)

movie_gross <- whole_db %>%
  dbGetQuery(getgross)
```

```{r}
#joining all the data sets in a way that we couldn't do all at once in SQL because it kept breaking the database when we tried (seemed ridiculous to have a huge sql query that took forever to test when we could sort what we needed from sql in smaller chunks and do the rest in dplyr)

movies <- movie_ids %>%
  left_join(movie_gross, by = "movie_id")%>%
  na.omit()%>%
  group_by(movie_id)%>%
  summarise(max_made = max(gross))%>%
  select(movie_id, max_made)%>%
  inner_join(movie_titles, by = "movie_id")%>%
  arrange(year)
```

